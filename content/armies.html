<h2>Armies</h2>
<div class="row">
    <div class="col" style="line-height: 1.0">
        <b>Approved</b> - Tournament ready and balanced<br>
        <b>Beta</b> - Currently being tested for approval<br>
        <b>Alpha</b> - Awaiting testing. Might experience significant rework<br>
        <b>Experimental</b> - Experiments and Fanlists. Suitable for casual play
    </div>
    <div class="col-2">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                    data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                <span id="list-filter">Filter: </span>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="content/armies.html?filter=approved">Approved</a>
                <a class="dropdown-item" href="content/armies.html?filter=beta">Beta+</a>
                <a class="dropdown-item" href="content/armies.html?filter=alpha">Alpha+</a>
                <a class="dropdown-item" href="content/armies.html?filter=all">All lists</a>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        console.log("[document-ready] initializing armies...");

        var urlSearchParams = new URLSearchParams(new URL('http://localhost' + history.state.url).search);
        var filter = urlSearchParams.get("filter");

        var states = ['approved'];

        if (filter === 'beta')
        {
            states.push('beta');
        }
        else if (filter === 'alpha')
        {
            states.push('beta');
            states.push('alpha');
        }
        else if (filter === 'all')
        {
            states.push('beta');
            states.push('alpha');
            states.push('experimental');
        }

        $("#list-filter").append(filter);

        $.getJSON("lists/index.json", function (data) {
            var filtered = data;
            console.log(data);

            filtered.index.forEach(section =>
                    section.index.forEach(race => {
                        race.lists = race.lists.filter(item => states.includes(item.status))
                    }));

            $("#content").append(eaTemplating.templates['list'](filtered))
        });
    });
</script>
